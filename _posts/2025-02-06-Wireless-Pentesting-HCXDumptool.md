---
layout: post
title: "Wireless Pentesting with HCXDumptool"
categories: guide
author:
- th4ntis
---

This will be a walkthrough used to obtain wireless handshakes and [PMKID](https://hashcat.net/forum/thread-7717.html) using [Hcxdumptool](https://github.com/ZerBea/hcxdumptool), [Hcxtools](https://github.com/ZerBea/hcxtools), and crack it using [Hashcat](https://github.com/hashcat/hashcat) 

***

# **This is for educational purposes and only to be performed on networks you have permission to do so.**

***

My notes on Wireless in general can be found [here](https://cybersec.th4ntis.com/networking/wireless).

My notes on Hashcat can be found [here](https://cybersec.th4ntis.com/tools/hash-cracking/hashcat).

This will require having a WiFi Adapter that supports monitor mode, also known as packet injection.

I myself have and recommend these adapters:

* [Alfa AWUS036ACM](https://www.amazon.com/Alfa-AWUS036ACM-Long-Range-Dual-Band-Wireless/dp/B073X6RL9D) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036ACHM](https://www.amazon.com/gp/product/B08SJBV1N3/ref=ox\_sc\_act\_title\_1?smid=A20G3A026MV70R\&psc=1) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036ACH](https://www.amazon.com/dp/B08SJC78FH?ref\_=cm\_sw\_r\_cp\_ud\_dp\_PSZZG6J9X0XH40GXB685) <-- Capable of 2.4GHz and 5GHz (This more than likely \*will\* require driver installation)
* [Panda Wireless PAU09 N600](https://www.amazon.com/Panda-Wireless-PAU09-Adapter-Antennas/dp/B01LY35HGO) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036NEH](https://www.amazon.com/AWUS036NEH-Range-WIRELESS-802-11b-USBAdapter/dp/B0035OCVO6)
* [Alfa AWUS036NH](https://www.amazon.com/Alfa-AWUS036NH-802-11g-Wireless-Long-Range/dp/B003YIFHJY)
* [Panda Wireless PAU05](https://www.amazon.com/Panda-300Mbps-Wireless-USB-Adapter/dp/B00EQT0YK2)
* [TP-Link TL-WN722N](https://www.amazon.com/TP-Link-TL-WN722N-Wireless-network-Adapter/dp/B002SZEOLG)
* [Ralink USB WiFi RT5370](https://www.amazon.com/Ralink-RT5370-Raspberry-Adapter-Function/dp/B019XUDHFC)

# HCXDumptool

Find your interface. If you have one network card(capable of monitor mode/packet injection) it will be `wlan0`, but if you have a second wireless USB dongle, it will most likely be `wlan1`.

```
iwconfig
```

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(1059).png" alt=""><figcaption></figcaption></figure>


Put interface into monitor mode

```shell-session
sudo airmon-ng start wlan1
```
<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(1060).png" alt=""><figcaption></figcaption></figure>

This may depends on which version you have installed. Eg. v6.2.9 has a different interface than v6.3.0+. I'll be going with the most up to date (currently v.6.3.5)

**This attack is not guaranteed!!**. Not all access points(APs) are vulnerable to the PMKID attack, BUT this can still obtain us EAPOL M1M2M3 or EAPOL M1M2M3M4 auths.

[Info on PMKID on Hashcat Forums](https://hashcat.net/forum/thread-7717.html)

## HCXDumptool v6.2.9

```
hcxdumptool -o (name).pcapng -i (interface) --enable_status=1 --filterlist_ap=target.txt --filtermode=2
```

![](<https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(702).png>)

Once we obtain our PMKID we will see it at the bottom

![](<https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(621).png>)

We MAY see `PMKID:XXXXXXXXXXXXXXX` OR `PMKIDROGUE:XXXXXXXXXXXXXXX`, Even potentially `M1M2ROGUE: XXXXXXXXXXXXXXX`.

* `PMKID:XXXXXXXXXXXXXXX KDV:2` means You captured a PMKID requested from a CLIENT. WPA version (Key Descriptor Version) is WPA 2. You can recover the password from this.
* PMKIDROGUE:`XXXXXXXXXXXXXXX KDV:2` means the PMKID is requested by hcxdumptool and not by a CLIENT. You can recover the password from this.
* `M1M2ROGUE : EAPOL M2` is requested from a CLIENT by hcxdumptool and not from an ACCESS POINT. You can recover the password from this.

## HCXDumptool v6.3.0+ (currently v6.3.5 as of writing this)

To target AP(s) we scan for target(s) with airodump-ng

```
sudo airodump-ng wlan1mon
```

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image.png" alt=""><figcaption></figcaption></figure>

Grab the BSSID(s) of our targets and put them in a Berkeley Packet Filter (BPF) `.bpf` file. with tcpdump OR hcxdumptool.

TCPDump

```
tcpdump -s 65535 -y IEEE802_11_RADIO wlan addr3 BSSID -ddd > SSID.bpf
```

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(1).png" alt=""><figcaption></figcaption></figure>

HCXDumptool

```
hcxdumptool --bpfc="wlan addr3 BSSID" > SSID.bpf
```

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(2).png" alt=""><figcaption></figcaption></figure>

\*\* NOTE: We can target multiple APs

TCPDump:

```
tcpdump -s 65535 -y IEEE802_11_RADIO wlan addr3 BSSID or wlan addr3 BSSID2 -ddd > SSID.bpf
```

HCXDumptool:

```
hcxdumptool --bpfc="wlan addr3 BSSID1 or wlan addr3 BSSID2" > SSID.bpf
```

Now run it against our target

```
sudo hcxdumptool --rds=1 -F --bpf=SSID.bpf -i wlan1mon -w outfile.pcapng
```

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(3).png" alt=""><figcaption></figcaption></figure>

***

To target all APs around(Not recommended without given permission)

```shell-session
sudo hcxdumptool -i wlan1mon -w outfile.pcapng
```

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(1069).png" alt=""><figcaption></figcaption></figure>

***

After a while we may see the + under the 3 or P of our target. Both of which can be used to obain the password with hashcat.

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(1070).png" alt=""><figcaption></figcaption></figure>

# Hash Cracking

So we now have our handshake in .cap format, we can crack the hash and find out the password.

### Hashcat

We have our PMKID in the .pcapng format, we can use hashcat to crack it. First we must use the `hcxpcapng` tool from [HCXtools](https://github.com/ZerBea/hcxtools).

```
sudo hcxpcapngtool -o SSIDHash outfile.cap (or .pcapng)
```

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(1071).png" alt=""><figcaption></figcaption></figure>

<figure><img src="https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(1072).png" alt=""><figcaption></figcaption></figure>

#### Dictionary

If we want to use a dictionary attack, like using `rockyou.txt` for example

```
sudo hashcat -m 22000 SSIDHash wordlist
```

![](<https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(326).png>)

![](<https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(524).png>)

Depending on your hardware, the dictionary you chose, and the password, this may take some time. You can press S for a status to see the time time estimated on finishing, as well as the updated "Recovered.Total" to see the recovered keys"

We can run the same command again with --show appended to the end to see our cracked passwords.

![](<https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(255).png>)

#### Brute Force

If we wanted to run a brute force attack rather than a dictionary attack, it's a similar command

```
hashcat -a 3 -w 3 -m 22000 (hash file) '?l?l?l?l?l?l?l'
```

Replace the `?l` with whatever we deem fit.
```
* ?l = a-z
* ?u = A-Z
* ?d = 0-9
* ?h = 0-9a-f
* ?H = 0-9A-F
* ?s = !"#$%&'()\*+,-./:;<=>?@\[]^\_\`{|}\~
* ?a = ?l?u?d?s
* ?b = 0x00 - 0xff
```
This will cover the basics of the hash cracking with hashcat but it can get SO much more advanced with hashcat.
