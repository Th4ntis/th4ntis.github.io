---
layout: post
title: "Wireless Pentesting with Bettercap"
categories: guide
author:
- th4ntis
---

This will be a walkthrough used to obtain wireless handshakes and [PMKID](https://hashcat.net/forum/thread-7717.html) using [Bettercap](../../tools/wireless/bettercap.md) and crack it using [Hashcat](https://github.com/hashcat/hashcat)

***

# **This is for educational purposes and only to be performed on networks you have permission to do so.**

***

My notes on Wireless in general can be found [here](https://cybersec.th4ntis.com/networking/wireless).

My notes on Hashcat can be found [here](https://cybersec.th4ntis.com/tools/hash-cracking/hashcat).

This will require having a WiFi Adapter that supports monitor mode, also known as packet injection.

I myself have and recommend these adapters:

* [Alfa AWUS036ACM](https://www.amazon.com/Alfa-AWUS036ACM-Long-Range-Dual-Band-Wireless/dp/B073X6RL9D) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036ACHM](https://www.amazon.com/gp/product/B08SJBV1N3/ref=ox\_sc\_act\_title\_1?smid=A20G3A026MV70R\&psc=1) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036ACH](https://www.amazon.com/dp/B08SJC78FH?ref\_=cm\_sw\_r\_cp\_ud\_dp\_PSZZG6J9X0XH40GXB685) <-- Capable of 2.4GHz and 5GHz (This more than likely \*will\* require driver installation)
* [Panda Wireless PAU09 N600](https://www.amazon.com/Panda-Wireless-PAU09-Adapter-Antennas/dp/B01LY35HGO) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036NEH](https://www.amazon.com/AWUS036NEH-Range-WIRELESS-802-11b-USBAdapter/dp/B0035OCVO6)
* [Alfa AWUS036NH](https://www.amazon.com/Alfa-AWUS036NH-802-11g-Wireless-Long-Range/dp/B003YIFHJY)
* [Panda Wireless PAU05](https://www.amazon.com/Panda-300Mbps-Wireless-USB-Adapter/dp/B00EQT0YK2)
* [TP-Link TL-WN722N](https://www.amazon.com/TP-Link-TL-WN722N-Wireless-network-Adapter/dp/B002SZEOLG)
* [Ralink USB WiFi RT5370](https://www.amazon.com/Ralink-RT5370-Raspberry-Adapter-Function/dp/B019XUDHFC)

# Bettercap

## Handshake

We need find our interface and put it into monitor mode.

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(236).png)

`sudo airmon-ng start (interface name)`

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(344).png)

Now we start bettercap selecting our interface

`bettercap -iface (interface)`

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(663).png)

We begin scanning for networks

`wifi.recon on`

We can also show the WiFi Manufacturer of the AP

`set wifi.show.manufacturer true`

`wifi.show`

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(269).png)

`set wifi.recon.channel (Channel)`

`set net.sniff.verbose true`

`set net.sniff.output (SSID).pcap`

`set net.sniff on`

`events.stream on`

At this point we can again, simply wait for a device to connect to the network to obtain the handshake, or we may deauthenticate the network.

`wifi.deauth (BSSID)`

Once we obtain the handshake, we will see the notification in our event stream

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(645).png)

## PMKID

The PMKID method is much simpler method. Just like before, we find our interface, enable monitor mode, start bettercap with that interface.

We begin scanning for networks

`wifi.recon on`

We can also show the WiFi Manufacturer of the AP

`set wifi.show.manufacturer true`

`wifi.show`

To start the PMKID attack we simply run

`wifi.assoc (BSSID)`

Once we have successfully received the RSN frame containing PMKID and it has been saved in a pcap format

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(565).png)

***

# Hashcracking with Hashcat

We have our PMKID in the .pcap format, we can use hashcat to crack it. First we must use the `hcxpcapng` tool from [HCXtools](https://github.com/ZerBea/hcxtools).

hcxpcapng -o CrackMe (.pcapng file)

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(721).png)

## Dictionary

If we want to use a dictionary attack, like using `rockyou.txt` for example

`hashcat -a 0 -w 3 -m 22000 (hash file) (wordlist)`

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(326).png)

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(524).png)

Depending on your hardware, the dictionary you chose, and the password, this may take some time. You can press S for a status to see the time time estimated on finishing, as well as the updated `Recovered.Total` to see the recovered keys.

We can run the same command again with --show appended to the end to see our cracked passwords.

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(255).png)

## Brute Force

If we wanted to run a brute force attack rather than a dictionary attack, it's a similar command

`hashcat -a 3 -w 3 -m 22000 (hash file) '?l?l?l?l?l?l?l'`

Replace the `?l` with whatever we see fit.
```
* ?l = a-z
* ?u = A-Z
* ?d = 0-9
* ?h = 0-9a-f
* ?H = 0-9A-F
* ?s = !"#$%&'()\*+,-./:;<=>?@\[]^\_\`{|}\~
* ?a = ?l?u?d?s
* ?b = 0x00 - 0xff
```
This will cover the basics of the hash cracking with hashcat but it can get SO much more advanced with hashcat. Especially when using rules like [OneRuleToRuleThemAllStill](https://github.com/stealthsploit/OneRuleToRuleThemStill) and modern wordlists like [rockyou2021.txt](https://chris.partridge.tech/2021/rockyou2021.txt-a-short-summary/).
