---
layout: post
title: "Wireless Pentesting with Bettercap"
categories: guide
author:
- th4ntis
---

This will be a walkthrough used to obtain wireless handshakes and [PMKID](https://hashcat.net/forum/thread-7717.html) using [Wifite](https://github.com/kimocoder/wifite2) and crack it using [Hashcat](https://github.com/hashcat/hashcat). This is a more automated way than using Aircrack or Betterecap.

***

# **This is for educational purposes and only to be performed on networks you have permission to do so.**

***

My notes on Wireless in general can be found [here](https://cybersec.th4ntis.com/networking/wireless).

My notes on Hashcat can be found [here](https://cybersec.th4ntis.com/tools/hash-cracking/hashcat).

This will require having a WiFi Adapter that supports monitor mode, also known as packet injection.

I myself have and recommend these adapters:

* [Alfa AWUS036ACM](https://www.amazon.com/Alfa-AWUS036ACM-Long-Range-Dual-Band-Wireless/dp/B073X6RL9D) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036ACHM](https://www.amazon.com/gp/product/B08SJBV1N3/ref=ox\_sc\_act\_title\_1?smid=A20G3A026MV70R\&psc=1) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036ACH](https://www.amazon.com/dp/B08SJC78FH?ref\_=cm\_sw\_r\_cp\_ud\_dp\_PSZZG6J9X0XH40GXB685) <-- Capable of 2.4GHz and 5GHz (This more than likely \*will\* require driver installation)
* [Panda Wireless PAU09 N600](https://www.amazon.com/Panda-Wireless-PAU09-Adapter-Antennas/dp/B01LY35HGO) <-- Capable of 2.4GHz and 5GHz
* [Alfa AWUS036NEH](https://www.amazon.com/AWUS036NEH-Range-WIRELESS-802-11b-USBAdapter/dp/B0035OCVO6)
* [Alfa AWUS036NH](https://www.amazon.com/Alfa-AWUS036NH-802-11g-Wireless-Long-Range/dp/B003YIFHJY)
* [Panda Wireless PAU05](https://www.amazon.com/Panda-300Mbps-Wireless-USB-Adapter/dp/B00EQT0YK2)
* [TP-Link TL-WN722N](https://www.amazon.com/TP-Link-TL-WN722N-Wireless-network-Adapter/dp/B002SZEOLG)
* [Ralink USB WiFi RT5370](https://www.amazon.com/Ralink-RT5370-Raspberry-Adapter-Function/dp/B019XUDHFC)

# Wifite

Specify a wireless interface with

```
sudo wifite -i wlan0
```

OR if we only have one WiFi interface on that is capable of monitor mode, we can just run it as is.

We can do a WPA attack on a target network with

```
sudo wifite --wpa
```

This will enable monitor mode on the wireless interface and begin scanning for networks.

I will target Pixel7, number 2

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(834).png)

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(835).png)

This starts with a PMKID attack, then moves onto a WPA Handshake attack if a PMKID is unable to be obtained.

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(836).png)

*Note, we can skip the PMKID attack by adding the argument `--no-pmkid`

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(837).png)

When obtaining a WPA handshake attack, this will attempt to de-authenticate clients from the network until we have obtained the handshake.

When the handshake is captured we see where it was saved to with the name of it. It will attempt to crack it automatically with `aircrack-ng` using their default worldlist `wordlist-probably.txt`

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(838).png)

If you would like to use your own dictionary, such as `rockyou.txt` we can use the `--dict` argument.

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(839).png)

***

# Hashcracking with Hashcat

We have our PMKID in the .pcap format, we can use hashcat to crack it. First we must use the `hcxpcapng` tool from [HCXtools](https://github.com/ZerBea/hcxtools).

hcxpcapng -o CrackMe (.pcapng file)

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(721).png)

## Dictionary

If we want to use a dictionary attack, like using `rockyou.txt` for example

`hashcat -a 0 -w 3 -m 22000 (hash file) (wordlist)`

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(326).png)

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(524).png)

Depending on your hardware, the dictionary you chose, and the password, this may take some time. You can press S for a status to see the time time estimated on finishing, as well as the updated `Recovered.Total` to see the recovered keys.

We can run the same command again with --show appended to the end to see our cracked passwords.

![](https://github.com/Th4ntis/CyberSecNotes/raw/main/.gitbook/assets/image%20(255).png)

## Brute Force

If we wanted to run a brute force attack rather than a dictionary attack, it's a similar command

`hashcat -a 3 -w 3 -m 22000 (hash file) '?l?l?l?l?l?l?l'`

Replace the `?l` with whatever we see fit.
```
* ?l = a-z
* ?u = A-Z
* ?d = 0-9
* ?h = 0-9a-f
* ?H = 0-9A-F
* ?s = !"#$%&'()\*+,-./:;<=>?@\[]^\_\`{|}\~
* ?a = ?l?u?d?s
* ?b = 0x00 - 0xff
```
This will cover the basics of the hash cracking with hashcat but it can get SO much more advanced with hashcat. Especially when using rules like [OneRuleToRuleThemAllStill](https://github.com/stealthsploit/OneRuleToRuleThemStill) and modern wordlists like [rockyou2021.txt](https://chris.partridge.tech/2021/rockyou2021.txt-a-short-summary/).
