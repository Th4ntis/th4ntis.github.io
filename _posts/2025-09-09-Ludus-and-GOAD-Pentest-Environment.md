---
layout: post
title: "Ludus and GOAD Pentest Environment"
categories: guide
author:
- th4ntis
---
# About
This home pentesting environment can come at a small price point, smaller than I originally thought I would need. You can find mini-pcs pretty cheap on eBay or on Facebook Marketplace in some cases. Just upgrade them a bit with more memory and potentially more storage, and you're set.

### [Ludus](https://docs.ludus.cloud/docs/intro/)
[Ludus](https://docs.ludus.cloud/docs/intro/) is a system to build easy to use cyber environments, or "ranges" for testing and development. Built on Proxmox, Ludus enables advanced automation while still allowing easy manual modifications or setup of virtual machines and networks. Ludus is implemented as a server that runs Packer and Ansible to create templates and deploy complex cyber environments from a single configuration file. Ludus is accessed via the Ludus CLI (client) or the Proxmox web interface. Normal users should not need to access Ludus via SSH.

There are also other [environments guides](https://docs.ludus.cloud/docs/category/environment-guides), such as setting up an [ADCS](https://docs.ludus.cloud/docs/environment-guides/adcs), [Malware Lab](https://docs.ludus.cloud/docs/environment-guides/malware-lab), [SCCM](https://docs.ludus.cloud/docs/environment-guides/sccm), and more to deploy on Ludus.

### [GOAD](https://orange-cyberdefense.github.io/GOAD/)
[Game Of Active Directory](https://orange-cyberdefense.github.io/GOAD/) is a free pentest active directory LAB(s) project. The purpose of this tool is to give pentesters a vulnerable Active directory environment ready to use to practice usual attack techniques. The idea behind this project is to give you an environment where you can try and train your pentest skills without having the pain to build all by yourself.

# Ludus
### Requirements
Ludus does have specific system requirements to be used. I've highlighted some specifics. 
<img width="1041" height="541" alt="image" src="https://github.com/user-attachments/assets/64410ed2-76e2-4792-92b0-7e9c78a7dc11" />

## Starting out
I am running this on a Lenovo ThinkCentre M70Q with:
- [Debian 12](https://www.debian.org/download)
- 64GB RAM
- A 1TB NVMe drive
- Intel-i5-10400T

## Installing
1. After installing [Debian 12](https://www.debian.org/download), while on the machine physically or accessing remotely, change to the root user
```
su -
```

2. Install the reqs
```
apt update && apt install curl sudo python3.11-venv 
```
<img width="860" height="429" alt="image" src="https://github.com/user-attachments/assets/e9840650-a727-4441-b76d-d83875026fce" />


3. Install Ludus - This will go through and ask a name for the node within Proxmox, the network interface you want to use, etc. As I set a static IP for my machine already, I am going to keep the information already populated and just enter through. This will restart the machine twice. I would give this about 15-20 min.
```
curl -s https://ludus.cloud/install | bash
```
<img width="733" height="447" alt="image" src="https://github.com/user-attachments/assets/4bbf7ea4-c9ac-4c8c-98aa-dab0dd25aae7" />
<img width="1919" height="809" alt="image" src="https://github.com/user-attachments/assets/bac5c9a4-77e8-47f3-b7a5-56a885f22cf8" />
<img width="888" height="1086" alt="image" src="https://github.com/user-attachments/assets/90bda764-b1f9-49af-98ad-d816e792cb0c" />
<img width="885" height="1041" alt="image" src="https://github.com/user-attachments/assets/870a16c5-80f0-4846-8b82-6c0fff80e37f" />
<img width="891" height="1024" alt="image" src="https://github.com/user-attachments/assets/976c5e06-6d8d-411d-85eb-673e1ceaa20b" />
<img width="736" height="865" alt="image" src="https://github.com/user-attachments/assets/218048e2-1ced-42c9-be33-f1cbe1de823a" />
<img width="642" height="138" alt="image" src="https://github.com/user-attachments/assets/d5b5c389-2d14-4dbd-85b5-9c0e0baa8aa8" />
<img width="529" height="250" alt="image" src="https://github.com/user-attachments/assets/41900942-3a6b-4c1b-bff4-ad7263f5e5f7" />

## Making an Admin User
1. Once installed, find the API Key. ** **WRITE THIS DOWN** **
```
ludus-install-status
```
<img width="540" height="88" alt="image" src="https://github.com/user-attachments/assets/dba738f1-59a9-4845-8097-3bff46a4443d" />

2. Make new admin user and get the new admin users API key. **WRITE THIS DOWN**. Replace 'API-KEY' with the root API key from the previous command.
```
LUDUS_API_KEY='API-KEY' \
 ludus user add --name "USER" --userid USER --admin --url https://127.0.0.1:8081
```

3. Set the API key for the newly created admin user
```
export LUDUS_API_KEY='API-KEY-OF-NEW-ADMIN-USER'
```

4. Getting Proxmox password for new user.  ** **WRITE THIS DOWN** **
```
ludus user creds get
```
<img width="1556" height="278" alt="image" src="https://github.com/user-attachments/assets/af8f067a-54e4-4180-a143-748914f8a222" />

# Building Templates for GOAD environment
1. View current templates
```
ludus templates list
```
<img width="421" height="227" alt="image" src="https://github.com/user-attachments/assets/0c0e002d-36cf-41f9-82d4-74d37e2bbbad" />

2. Get new templates needed for GOAD.
```
git clone https://gitlab.com/badsectorlabs/ludus && cd ludus/templates
ludus templates add -d win2019-server-x64
ludus templates add -d win2016-server-x64
```
<img width="645" height="367" alt="image" src="https://github.com/user-attachments/assets/6a84dbe5-75a9-4b42-927a-84e198574a4d" />

3. Build the templates - This will take a while
```
ludus templates build
```

4. While it builds, you can check status of builds with:
```
ludus templates logs -f
```
<img width="1918" height="147" alt="image" src="https://github.com/user-attachments/assets/64281b7d-464a-4ff6-a113-9d006d441487" />

Once the templates are installed, you will see it say it's complete.
<img width="545" height="384" alt="image" src="https://github.com/user-attachments/assets/b4c57c2d-fdd4-4fc7-845e-a432aab0ab5a" />

# GOAD
1. Clone the GOAD repository
```
git clone https://github.com/Orange-Cyberdefense/GOAD.git && cd GOAD
````

3. Start GOAD, check that everything is set with no errors, and install. This will take a long time.
```
./goad.sh -p ludus
```

4. Exit GOAD and update `/root/.goad/goad.ini` with your users API key
```

```

```
GOAD/ludus/local > check
GOAD/ludus/local > set_lab XXX # GOAD/GOAD-Light/NHA/SCCM
GOAD/ludus/local > install
```
<img width="744" height="263" alt="image" src="https://github.com/user-attachments/assets/3a1c8d02-2b33-4759-b5a9-b8f9a4811d04" />
<img width="1920" height="733" alt="image" src="https://github.com/user-attachments/assets/e186d4b6-a7e0-4ec0-8b3d-9dfffa68e686" />
<img width="1918" height="891" alt="image" src="https://github.com/user-attachments/assets/70cec179-598d-4dfc-a251-73bee75b8831" />


I did have a couple error that stopped the install, so added the API of my admin user key to `/root/.goad/goad.ini` then started the install again.
```
./goad.sh -p ludus
GOAD/ludus/local > install
```
<img width="903" height="324" alt="image" src="https://github.com/user-attachments/assets/a4872ca4-71e1-4343-ae31-0e07216e9ccc" />
<img width="1029" height="299" alt="image" src="https://github.com/user-attachments/assets/8b26122f-a67b-46d1-950c-de107806bcda" />

Then once more when it was using the API key from the environment and deploying, so I had to load the instance from within GOAD.
```
./goad.sh
GOAD/ludus/local > ls
GOAD/ludus/local > load (INSTANCE-ID)
GOAD/ludus/local > install
```
<img width="968" height="521" alt="image" src="https://github.com/user-attachments/assets/67de6a91-833f-4f1f-aff0-078ca4ec0533" />

# Kali VM with Ludus and GOAD
1. Find the GOAD UserID
```
ludus users list all
```
<img width="692" height="162" alt="image" src="https://github.com/user-attachments/assets/5182d82f-f0f0-4ad6-bf70-3514b9dde07a" />

2. Get the `config.yml` file
```
ludus --user GOAD-USERID range config get > basic-config.yml
```
<img width="607" height="86" alt="image" src="https://github.com/user-attachments/assets/3a3f90fd-d0a8-4f61-8eed-e8f66ab38d95" />

3. Edit the `basic-config.yml` file with the following added to the bottom
```yaml
  - vm_name: "{{ range_id }}-kali"
    hostname: "{{ range_id }}-kali"
    template: kali-x64-desktop-template
    vlan: 10
    ip_last_octet: 99
    ram_gb: 4
    cpus: 4
    linux: true
    testing:
      snapshot: false
      block_internet: false
```

4. Set the new config file and deploy it
```
ludus --user GOAD-USERID range config set -f basic-config.yml
ludus --user GOAD-USERID range deploy -t vm-deploy
```

5. Check on the deployment process
```
ludus --user GOAD-USERID range logs -f
```
<img width="726" height="381" alt="image" src="https://github.com/user-attachments/assets/ae79b3cc-174b-4187-b3f7-57fa1b7591bc" />
<img width="1031" height="86" alt="image" src="https://github.com/user-attachments/assets/b83f0801-2d6b-49bb-86c0-6fd1f9687d54" />

6. Deploy the Kali VM
```
ludus --user GOAD-USERID range deploy --limit localhost,GOAD-USERID-kali
```
<img width="761" height="340" alt="image" src="https://github.com/user-attachments/assets/609e6aab-47e3-40b7-ab3d-0503b9389598" />
<img width="1037" height="72" alt="image" src="https://github.com/user-attachments/assets/10eb6a43-4f15-4f31-a8a7-94f572e1702e" />


7. Verify all VMs with their status
```
ludus --user GOAD-USERID range status
```
<img width="1036" height="360" alt="image" src="https://github.com/user-attachments/assets/697647fd-9fbb-47fd-92b6-00d7b510b7f7" />

8. Get Wireguard configuration file
```
ludus user wireguard | tee ludus.conf
```
<img width="583" height="242" alt="image" src="https://github.com/user-attachments/assets/da844472-2d6d-4973-86bf-19ed8c6f63f5" />

9. Save the file as a `.conf` file and use Wireguard to connect to it. Once connected, access your Kali machine via GUI in the browser, over SSH.
```
sudo wg-quick up GOAD.conf
```
<img width="1708" height="1026" alt="image" src="https://github.com/user-attachments/assets/f4325780-2407-4e80-8998-7df7f776e760" />
<img width="642" height="341" alt="image" src="https://github.com/user-attachments/assets/7f8e2cdc-3b40-45e3-8f80-192ea3bc2fbb" />


# I will be posting how to attack this environment soon! Keep an eye out!
